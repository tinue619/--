# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Cabinet Editor v3

## üì¶ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### config.js
–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
- `CONFIG` - –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ä–∞–∑–º–µ—Ä—ã, —Ü–≤–µ—Ç–∞, UI)
- `CALC` - –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### Panel.js
–ö–ª–∞—Å—Å –ø–∞–Ω–µ–ª–∏ (–ø–æ–ª–∫–∞ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å):
- `type` - 'shelf' –∏–ª–∏ 'divider'
- `position` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ({x} –∏–ª–∏ {y})
- `bounds` - –≥—Ä–∞–Ω–∏—Ü—ã (startX/endX –∏–ª–∏ startY/endY)
- `connections` - —Å–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞–Ω–µ–ª—è–º–∏
- `ribs` - –º–∞—Å—Å–∏–≤ —Ä–µ–±–µ—Ä –∂–µ—Å—Ç–∫–æ—Å—Ç–∏

**–ú–µ—Ç–æ–¥—ã:**
- `updateRibs()` - –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–±–µ—Ä –∂–µ—Å—Ç–∫–æ—Å—Ç–∏
- `intersects()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
- `getGeometry()` - –≥–µ–æ–º–µ—Ç—Ä–∏—è –¥–ª—è 3D
- `get3DPosition()` - –ø–æ–∑–∏—Ü–∏—è –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ

### Viewer3D.js
3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Three.js:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω—ã, –∫–∞–º–µ—Ä—ã, –æ—Å–≤–µ—â–µ–Ω–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–ø—É—Å–∞ —à–∫–∞—Ñ–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–ø–∞–Ω–µ–ª–∏)
- OrbitControls –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### App.js
–ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `panels` - Map –≤—Å–µ—Ö –ø–∞–Ω–µ–ª–µ–π
- `mode` - —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
- `interaction` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- `history` - –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è undo/redo
- `canvas` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2D canvas
- `viewer3D` - —ç–∫–∑–µ–º–ø–ª—è—Ä 3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞
- `mesh3D` - Map 3D –æ–±—ä–µ–∫—Ç–æ–≤ –ø–∞–Ω–µ–ª–µ–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

*–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:*
- `init()` - –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `setupEvents()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

*UI:*
- `setMode()` - —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞
- `switchTab()` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
- `updateStatus()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

*Canvas:*
- `updateCanvas()` - –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤
- `getCoords()` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- `render2D()` - –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ 2D

*–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:*
- `handlePointer()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ pointer events
- `startInteraction()` - –Ω–∞—á–∞–ª–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- `updateInteraction()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (drag)
- `endInteraction()` - –∫–æ–Ω–µ—Ü –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- `findPanelAt()` - –ø–æ–∏—Å–∫ –ø–∞–Ω–µ–ª–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º

*–ü–∞–Ω–µ–ª–∏:*
- `addPanel()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
- `movePanel()` - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
- `deletePanel()` - —É–¥–∞–ª–µ–Ω–∏–µ —Å –∫–∞—Å–∫–∞–¥–æ–º
- `rebuildAllConnections()` - –ø–µ—Ä–µ—Å—á–µ—Ç –≤—Å–µ—Ö —Å–≤—è–∑–µ–π

*3D:*
- `initViewer3D()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D
- `renderAll3D()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö 3D –æ–±—ä–µ–∫—Ç–æ–≤
- `updateMesh()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 3D –º–µ—à–∞ –ø–∞–Ω–µ–ª–∏
- `removeMesh()` - —É–¥–∞–ª–µ–Ω–∏–µ 3D –º–µ—à–∞

*–ò—Å—Ç–æ—Ä–∏—è:*
- `saveHistory()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `undo()` / `redo()` - –æ—Ç–º–µ–Ω–∞/–≤–æ–∑–≤—Ä–∞—Ç
- `restoreState()` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

*–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:*
- `saveToStorage()` - –≤ localStorage
- `loadState()` - –∏–∑ localStorage

### main.js
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è App

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
1. –ö–ª–∏–∫ –Ω–∞ canvas ‚Üí `endInteraction()`
2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∏ –ø–æ–∑–∏—Ü–∏–∏
3. –ü–æ–∏—Å–∫ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π —Å –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ã–º–∏ –ø–∞–Ω–µ–ª—è–º–∏
4. –†–∞—Å—á–µ—Ç bounds –∏ connections
5. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ Panel
6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `panels` Map
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
8. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ 2D + —Å–æ–∑–¥–∞–Ω–∏–µ 3D –º–µ—à–∞

### –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
1. Pointer down ‚Üí `startInteraction()` (–Ω–∞—Ö–æ–¥–∏–º –ø–∞–Ω–µ–ª—å)
2. Pointer move ‚Üí `updateInteraction()` ‚Üí `movePanel()`
3. –†–∞—Å—á–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–∞–Ω–µ–ª–µ–π
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
5. `rebuildAllConnections()` - –ø–µ—Ä–µ—Å—á–µ—Ç –≤—Å–µ—Ö —Å–≤—è–∑–µ–π
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ—Ä –∂–µ—Å—Ç–∫–æ—Å—Ç–∏
7. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ 2D + 3D
8. Pointer up ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
1. –ö–ª–∏–∫ –≤ —Ä–µ–∂–∏–º–µ delete ‚Üí `deletePanel()`
2. –ü–æ–∏—Å–∫ –∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–∞–Ω–µ–ª–µ–π (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)
3. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞–Ω–µ–ª–µ–π –∏–∑ Set
4. –£–¥–∞–ª–µ–Ω–∏–µ 3D –º–µ—à–µ–π
5. `rebuildAllConnections()` –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 2D –∏ 3D

### –°–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π (connections)

**rebuildAllConnections():**
- –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–µ –ø–∞–Ω–µ–ª–∏
- –î–ª—è –ø–æ–ª–æ–∫: —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞
- –î–ª—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π: –ø–æ–ª–∫–∏ —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É
- –û–±–Ω–æ–≤–ª—è–µ—Ç bounds –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–±—Ä–∞ –∂–µ—Å—Ç–∫–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª–æ–∫

## üé® Rendering

### 2D (Canvas)
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: Y –≤–≤–µ—Ä—Ö, –Ω–∞—á–∞–ª–æ –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ —Ä–∞–∑–º–µ—Ä—É canvas
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞: –∫–æ—Ä–ø—É—Å ‚Üí –ø–∞–Ω–µ–ª–∏ ‚Üí —Ä–µ–±—Ä–∞

### 3D (Three.js)
- –°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: –Ω–∞—á–∞–ª–æ –≤ —Ü–µ–Ω—Ç—Ä–µ —à–∫–∞—Ñ–∞
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞: –∫–æ—Ä–ø—É—Å —à–∫–∞—Ñ–∞
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞: –ø–∞–Ω–µ–ª–∏ –∏ —Ä–µ–±—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

## üíæ –î–∞–Ω–Ω—ã–µ

### LocalStorage
–ö–ª—é—á: `cabinetDesignV3`

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```json
{
  "panels": [
    {
      "type": "shelf|divider",
      "id": "shelf-0",
      "position": { "y": 500 },
      "bounds": { "startX": 16, "endX": 984 },
      "connections": { "left": null, "right": null }
    }
  ],
  "nextId": 1,
  "history": {
    "states": [...],
    "index": 0
  }
}
```

## üîç –ö–ª—é—á–µ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
1. –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ã–µ –ø–∞–Ω–µ–ª–∏
2. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ–∑–∏—Ü–∏–∏
3. –°–æ–∑–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫ (–≥—Ä–∞–Ω–∏—Ü—ã + –ø–∞–Ω–µ–ª–∏)
4. –ù–∞–π—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –∫–ª–∏–∫–∞
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å bounds –∏ connections

### –ü–µ—Ä–µ—Å—á–µ—Ç —Å–≤—è–∑–µ–π
1. –î–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö: –Ω–∞–π—Ç–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ Y
2. –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö: –Ω–∞–π—Ç–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ X
3. –°–æ–∑–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏
4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–µ–≥–º–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏
5. –û–±–Ω–æ–≤–∏—Ç—å bounds –∏ connections

### –†–µ–±—Ä–∞ –∂–µ—Å—Ç–∫–æ—Å—Ç–∏
1. –ù–∞–π—Ç–∏ –≤—Å–µ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (–±–æ–∫–æ–≤–∏–Ω—ã + —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏)
2. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–µ, —á—Ç–æ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç –ø–æ–ª–∫—É
3. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ X
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–ª–µ—Ç–∞: –µ—Å–ª–∏ >800–º–º, –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—Ä–æ
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞—Å—Å–∏–≤ {startX, endX}

## üêõ –û—Ç–ª–∞–¥–∫–∞

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–µ–Ω:
```javascript
window.cabinetApp
```

–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```javascript
// –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–∞–Ω–µ–ª–µ–π
cabinetApp.panels

// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
cabinetApp.history.states[cabinetApp.history.index]

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
cabinetApp.saveToStorage()

// –û—á–∏—Å—Ç–∫–∞ localStorage
localStorage.removeItem('cabinetDesignV3')
```
